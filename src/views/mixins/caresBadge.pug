//- CARES Badge Mixin
//- Displays a green pill badge linking to the CARES Fish Preservation Program
//-
//- Parameters:
//-   size - Optional size variant: 'sm' (small, inline), 'md' (medium, default)

include hoverCard.pug

mixin caresBadge(size)
	- const sizeClasses = size === 'sm' ? 'px-2 py-0.5 text-xs' : 'px-3 py-1 text-sm'
	a(
		class=`inline-flex items-center rounded-full font-semibold bg-green-100 text-green-800 hover:bg-green-200 ${sizeClasses}`
		href="https://caresforfish.org/"
		target="_blank"
		rel="noopener noreferrer"
		title="This species is part of the C.A.R.E.S. preservation program"
	) C.A.R.E.S.

//- Enhanced CARES Badge with HoverCard
//- Displays CARES badge with rich tooltip showing program details
//-
//- Parameters:
//-   size - Badge size: 'sm' or 'md' (default: 'md')
//-   species - Optional species object with genus and species name for search link
//-   uniqueId - Unique identifier for this instance (e.g., species group_id)
//-
//- Usage:
//-   +caresBadgeWithHover('sm', species, species.group_id)

mixin caresBadgeWithHover(size, species, uniqueId)
	- const sizeClasses = size === 'sm' ? 'px-2 py-0.5 text-xs' : 'px-3 py-1 text-sm'
	- const scientificName = species ? `${species.canonical_genus} ${species.canonical_species_name}` : null

	+hoverCard({id: `cares-${uniqueId}`, side: 'top', width: 'lg', openDelay: 200, closeDelay: 300})
		+hoverCardTrigger()
			span(
				class=`inline-flex items-center rounded-full font-semibold bg-green-100 text-green-800 cursor-help ${sizeClasses}`
			) C.A.R.E.S.

		+hoverCardContent({cardClasses: 'border-2 border-green-400'})
			.space-y-3
				//- Header: CARES logo/icon and name
				.flex.flex-col.items-center.gap-2
					.text-3xl üêü
					div.text-center
						.font-bold.text-gray-900 C.A.R.E.S. Program
						.text-xs.text-gray-500 Fish Preservation Initiative

				//- Divider
				.border-t.border-gray-200

				//- Acronym Explanation
				.text-sm
					.font-semibold.text-gray-700.mb-2 Conservation ¬∑ Awareness ¬∑ Recognition ¬∑ Encouragement ¬∑ Support

				//- Program Description
				.text-sm.text-gray-700.leading-relaxed
					| This species is part of the CARES preservation program - a global initiative focused on captive breeding and preservation of at-risk fish species.

				//- Why It Matters
				.bg-green-50.rounded.p-3.border.border-green-200
					.text-sm.font-semibold.text-green-800.mb-1 Why This Matters
					.text-sm.text-green-700.italic
						| Hobbyists play a critical role in conservation by maintaining breeding populations of threatened species in aquariums.

				//- IUCN Status (if available and species provided)
				if species && species.iucn_redlist_category
					.flex.items-center.gap-2.text-sm
						span.text-gray-700.font-semibold IUCN Status:
						- const categoryLabels = { CR: 'Critically Endangered', EN: 'Endangered', VU: 'Vulnerable', NT: 'Near Threatened', LC: 'Least Concern', DD: 'Data Deficient', NE: 'Not Evaluated' }
						- const categoryLabel = categoryLabels[species.iucn_redlist_category] || species.iucn_redlist_category
						span.text-gray-900= categoryLabel
						if species.iucn_population_trend
							- const trendIcons = { Increasing: '‚Üë', Decreasing: '‚Üì', Stable: '‚Üî', Unknown: '?' }
							- const trendColors = { Increasing: 'text-green-600', Decreasing: 'text-red-600', Stable: 'text-blue-600', Unknown: 'text-gray-500' }
							span(class=trendColors[species.iucn_population_trend] || 'text-gray-500')= trendIcons[species.iucn_population_trend]

				//- Species-Specific Link (if species provided)
				if scientificName
					.border-t.border-gray-200.pt-2
						.text-xs.text-gray-600.mb-2
							strong Species:
							|  #{scientificName}
						a(
							href=`https://caresforfish.org/?s=${encodeURIComponent(scientificName)}`
							target="_blank"
							rel="noopener noreferrer"
							class="inline-flex items-center gap-1 text-sm font-medium text-green-600 hover:text-green-800"
						)
							span Search on CARES Website
							svg.w-4.h-4(fill="none" stroke="currentColor" viewBox="0 0 24 24")
								path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14")
				else
					//- General CARES Link
					.border-t.border-gray-200.pt-2
						a(
							href="https://caresforfish.org/"
							target="_blank"
							rel="noopener noreferrer"
							class="inline-flex items-center gap-1 text-sm font-medium text-green-600 hover:text-green-800"
						)
							span Learn More About CARES
							svg.w-4.h-4(fill="none" stroke="currentColor" viewBox="0 0 24 24")
								path(stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14")
