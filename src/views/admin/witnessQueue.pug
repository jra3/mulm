include ../header.pug
include queueButton.pug
include adminNav.pug
include ../mixins/submissionImages.pug
include ../mixins/date.pug

- const stringCell = ['p-3', 'text-left', 'border-b', 'border-gray-200'];
- const heading = ['p-3', 'text-left', 'font-bold', 'text-gray-900', 'border-b-2', 'border-gray-300', 'bg-gray-50', 'cursor-pointer', 'select-none', 'hover:bg-gray-100'];

mixin witnessQueueTable(submissions)
	.overflow-x-auto.w-full
		table(data-sortable class="w-full bg-white shadow-sm rounded-lg")
			thead
				tr
					th(class=heading) Status
					th(class=heading) Member Name
					th(class=heading) Species Class
					th(class=heading) Common Name
					th(class=heading) Latin Name
					th(class=heading) Reproduction Date
					th(class=heading data-sort-method="date" data-sort-default) Submitted On
					th(class="p-3 text-left font-bold text-gray-900 border-b-2 border-gray-300 bg-gray-50" data-sort-method="none") Actions

			tbody
				each sub in submissions
					- const rowClass = sub.statusInfo ? `hover:bg-gray-50 ${sub.statusInfo.rowColor}` : "hover:bg-gray-50"
					tr(class=rowClass)
						td(class=stringCell)
							if sub.statusInfo
								- const icon = sub.statusInfo.status === 'draft' ? '📝' : sub.statusInfo.status === 'pending-witness' ? '👁️' : sub.statusInfo.status === 'waiting-period' ? '⏳' : sub.statusInfo.status === 'pending-approval' ? '🔵' : sub.statusInfo.status === 'approved' ? '✅' : sub.statusInfo.status === 'denied' ? '❌' : ''
								span(
									class=`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${sub.statusInfo.bgColor} ${sub.statusInfo.color}`
									title=sub.statusInfo.description
								)
									span.mr-1= icon
									span= sub.statusInfo.label
									if sub.statusInfo.daysRemaining !== undefined
										span.ml-1.font-normal= `(${sub.statusInfo.daysRemaining}d)`
							else
								span.text-gray-500 Unknown
						td(class=stringCell)= sub.member_name
						td(class=stringCell)= sub.species_class
						td(class=stringCell)= sub.species_common_name
						td(class=stringCell)= sub.species_latin_name
						td(class=stringCell)
							+shortDate(sub.reproduction_date, "Reproduction date")
						td(class=stringCell)
							+shortDate(sub.submitted_on, "Submitted on")
						td(class=stringCell)
							a(class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800 hover:bg-blue-200 transition-colors" href=`/submissions/${sub.id}`) Review

doctype html
html
	+headTag(title)
		script(src='/tablesort.min.js')
		script(src='/tablesort.number.min.js')
		script(src='/tablesort.date.min.js')
		script.
			document.addEventListener('DOMContentLoaded', function() {
				const tables = document.querySelectorAll('table[data-sortable]');
				tables.forEach(table => {
					new Tablesort(table, {
						descending: true // Default to descending for date (most recent first)
					});
				});
			});

	body.bg-white.text-gray-800
		+pageHeader(true, title, subtitle)

		.container.mx-auto.px-4.py-6
			if submissions && submissions.length > 0
				+witnessQueueTable(submissions)
			else
				.text-center.py-12
					.text-gray-500.text-lg No submissions awaiting admin screening for #{subtitle.toLowerCase()}.
					p.text-sm.text-gray-400.mt-2 Check other programs using the navigation below.

		+adminNav("witness", {}, programCounts)