include ../header.pug

+sidebar()
  h2.text-xl.font-bold.text-gray-900.mb-4 Edit Species

  form(
    hx-patch=`/admin/species/${species.group_id}`
    hx-swap="none"
    hx-on--after-request="if(event.detail.successful) { document.getElementById('sidebar').remove(); window.location.reload(); }"
  )

    //- Canonical Name Section (Warning)
    .bg-yellow-50.border.border-yellow-200.rounded-lg.p-4.mb-6
      .flex.items-start.gap-2
        svg.w-5.h-5.text-yellow-600.flex-shrink-0(fill="currentColor" viewBox="0 0 20 20")
          path(fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd")
        div
          h3.text-sm.font-semibold.text-yellow-800 Canonical Name
          p.text-xs.text-yellow-700.mt-1 Changes affect all references. Use with caution.

      .grid.gap-3.mt-3
        div
          label.block.text-xs.font-medium.text-gray-700.mb-1(for="canonical_genus") Genus
          input.text-input(
            type="text"
            id="canonical_genus"
            name="canonical_genus"
            value=species.canonical_genus
            required
          )

        div
          label.block.text-xs.font-medium.text-gray-700.mb-1(for="canonical_species_name") Species
          input.text-input(
            type="text"
            id="canonical_species_name"
            name="canonical_species_name"
            value=species.canonical_species_name
            required
          )

    //- Classification
    .mb-6
      h3.text-sm.font-semibold.text-gray-900.mb-3 Classification

      .grid.gap-3
        div
          label.block.text-xs.font-medium.text-gray-700.mb-1(for="program_class") Program Class
          input.text-input(
            type="text"
            id="program_class"
            name="program_class"
            value=species.program_class
            required
          )

    //- Points & Status
    .mb-6
      h3.text-sm.font-semibold.text-gray-900.mb-3 Points & Status

      .grid.gap-3
        div
          label.block.text-xs.font-medium.text-gray-700.mb-1(for="base_points") Base Points
          .select-wrapper
            select#base_points(name="base_points")
              option(value="" selected=!species.base_points) Not assigned
              option(value="5" selected=species.base_points === 5) 5 points
              option(value="10" selected=species.base_points === 10) 10 points
              option(value="15" selected=species.base_points === 15) 15 points
              option(value="20" selected=species.base_points === 20) 20 points
          p.text-xs.text-gray-500.mt-1 Standard point values for breeding

        div
          label.flex.items-center.gap-2.cursor-pointer
            input(
              type="checkbox"
              name="is_cares_species"
              id="is_cares_species"
              checked=species.is_cares_species
              class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
            )
            span.text-sm.font-medium.text-gray-700 CARES Conservation Species
          p.text-xs.text-gray-500.mt-1 Conservation, Awareness, Recognition, Encouragement, Support

    //- Synonyms List
    .mb-6
      .flex.justify-between.items-center.mb-3
        h3.text-sm.font-semibold.text-gray-900 Name Variants (#{species.synonyms.length})
        button.outline.text-xs.px-2.py-1(
          type="button"
          hx-get=`/admin/species/${species.group_id}/synonyms/new`
          hx-target="#synonym-list"
          hx-swap="beforeend"
        ) + Add

      #synonym-list.space-y-2
        if species.synonyms && species.synonyms.length > 0
          each synonym in species.synonyms
            .flex.items-center.gap-2.p-2.bg-gray-50.rounded.border.border-gray-200
              .flex-1.grid.grid-cols-2.gap-2.text-xs
                div
                  .text-gray-500 Common:
                  .font-medium= synonym.common_name
                div
                  .text-gray-500 Scientific:
                  .font-medium.italic= synonym.scientific_name
              .flex.gap-1
                button.outline.text-xs.px-2.py-1(
                  type="button"
                  hx-delete=`/admin/species/${species.group_id}/synonyms/${synonym.name_id}`
                  hx-confirm="Delete this synonym?"
                  hx-target="closest .flex.items-center"
                  hx-swap="outerHTML swap:0.5s"
                  title="Delete synonym"
                ) üóëÔ∏è
        else
          .text-sm.text-gray-500.italic No synonyms added yet

    //- Actions
    .flex.gap-2.pt-4.border-t.border-gray-300
      button.primary.flex-1(type="submit" hx-disabled-elt="this") Save Changes
      button.outline.flex-1(
        type="button"
        hx-on:click="document.getElementById('sidebar').remove()"
      ) Cancel

    .mt-4.pt-4.border-t.border-gray-300
      button.destructive.w-full(
        type="button"
        hx-delete=`/admin/species/${species.group_id}`
        hx-confirm="Delete this species and all its synonyms? This cannot be undone."
        hx-on--after-request="if(event.detail.successful) { document.getElementById('sidebar').remove(); window.location.reload(); }"
      ) Delete Species
