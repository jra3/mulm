include ../header.pug

doctype html
html
  +headTag(title)

  body.bg-white.text-gray-800
    +pageHeader(true, title)

    section.bg-gray-100.py-6
      div.max-w-4xl.mx-auto.px-4

        //- Breadcrumb
        .mb-6
          nav.flex(aria-label="Breadcrumb")
            ol.inline-flex.items-center.space-x-1(class="md:space-x-3")
              li.inline-flex.items-center
                a(class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600" href="/admin/species")
                  | Species Management
              li
                .flex.items-center
                  svg.w-6.h-6.text-gray-400(fill="currentColor" viewBox="0 0 20 20")
                    path(fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd")
                  span.ml-1.text-sm.font-medium.text-gray-500(class="md:ml-2")= `${species.canonical_genus} ${species.canonical_species_name}`

        h1.text-2xl.font-bold.text-gray-900.mb-6 Edit Species

        form(
          hx-patch=`/admin/species/${species.group_id}`
          hx-swap="none"
          hx-on--after-request="if(event.detail.successful) { window.location.href='/admin/species'; }"
        )

          //- Canonical Name Section (Warning)
          .bg-yellow-50.border.border-yellow-200.rounded-lg.p-6.mb-6
            .flex.items-start.gap-3.mb-4
              svg.w-6.h-6.text-yellow-600.flex-shrink-0(fill="currentColor" viewBox="0 0 20 20")
                path(fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd")
              div
                h3.text-base.font-semibold.text-yellow-800 Canonical Name
                p.text-sm.text-yellow-700.mt-1 Changes to the canonical name affect all references throughout the system. Use with caution.

            .grid.gap-4(class="md:grid-cols-2")
              div
                label.input-label(for="canonical_genus") Genus
                input.text-input(
                  type="text"
                  id="canonical_genus"
                  name="canonical_genus"
                  value=species.canonical_genus
                  required
                )

              div
                label.input-label(for="canonical_species_name") Species
                input.text-input(
                  type="text"
                  id="canonical_species_name"
                  name="canonical_species_name"
                  value=species.canonical_species_name
                  required
                )

          //- Classification
          .bg-white.rounded-lg.shadow-md.p-6.mb-6
            h3.text-lg.font-bold.text-gray-900.mb-4 Classification

            div
              label.input-label(for="program_class") Program Class
              input.text-input(
                type="text"
                id="program_class"
                name="program_class"
                value=species.program_class
                required
                placeholder="e.g., Cichlids, Livebearers, Cryptocoryne"
              )
              p.text-xs.text-gray-500.mt-1 BAP/HAP/CAP program class

          //- Points & Status
          .bg-white.rounded-lg.shadow-md.p-6.mb-6
            h3.text-lg.font-bold.text-gray-900.mb-4 Points & Conservation Status

            .grid.gap-4(class="md:grid-cols-2")
              div
                label.input-label(for="base_points") Base Points
                .select-wrapper
                  select#base_points(name="base_points")
                    option(value="" selected=!species.base_points) Not assigned
                    option(value="5" selected=species.base_points === 5) 5 points
                    option(value="10" selected=species.base_points === 10) 10 points
                    option(value="15" selected=species.base_points === 15) 15 points
                    option(value="20" selected=species.base_points === 20) 20 points
                p.text-xs.text-gray-500.mt-1 Points awarded for breeding

              div
                label.input-label.mb-3 Conservation Status
                label.flex.items-center.gap-2.cursor-pointer
                  input(
                    type="checkbox"
                    name="is_cares_species"
                    id="is_cares_species"
                    checked=species.is_cares_species
                    class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                  )
                  span.text-sm.font-medium.text-gray-700 CARES Conservation Species
                p.text-xs.text-gray-500.mt-1 Conservation, Awareness, Recognition, Encouragement, Support

          //- Synonyms List
          .bg-white.rounded-lg.shadow-md.p-6.mb-6
            .flex.justify-between.items-center.mb-4
              h3.text-lg.font-bold.text-gray-900 Name Variants (#{species.synonyms.length})
              button.outline(
                type="button"
                hx-get=`/admin/species/${species.group_id}/synonyms/new`
                hx-target="#synonym-list"
                hx-swap="beforeend"
              ) + Add Synonym

            #synonym-list.space-y-2
              if species.synonyms && species.synonyms.length > 0
                each synonym in species.synonyms
                  .flex.items-center.gap-3.p-3.bg-gray-50.rounded.border.border-gray-200
                    .flex-1.grid.gap-3(class="md:grid-cols-2")
                      div
                        .text-gray-500.text-xs.mb-1 Common Name:
                        .font-medium= synonym.common_name
                      div
                        .text-gray-500.text-xs.mb-1 Scientific Name:
                        .font-medium.italic= synonym.scientific_name
                    button.destructive(
                      type="button"
                      hx-delete=`/admin/species/${species.group_id}/synonyms/${synonym.name_id}`
                      hx-confirm="Delete this synonym?"
                      hx-target="closest .flex.items-center"
                      hx-swap="outerHTML swap:0.5s"
                    ) Delete
              else
                .text-sm.text-gray-500.italic.text-center.py-4 No synonyms added yet

          //- Actions
          .flex.gap-3.justify-center
            button.primary(type="submit" hx-disabled-elt="this") Save Changes
            a.outline(
              href="/admin/species"
              class="rounded-2xl text-sm font-medium h-9 px-4 py-2 shadow-sm transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 flex items-center justify-center gap-2 border-gray-500 hover:bg-gray-200 no-underline"
            ) Cancel

          //- Danger Zone
          .mt-6.pt-6.border-t.border-gray-300
            .bg-red-50.border.border-red-200.rounded-lg.p-4
              h4.text-sm.font-semibold.text-red-800.mb-2 Danger Zone
              p.text-sm.text-red-700.mb-3 Deleting this species will remove all synonyms and cannot be undone.
              button.destructive.w-full(
                type="button"
                hx-delete=`/admin/species/${species.group_id}`
                hx-confirm="Delete this species and all its synonyms? This cannot be undone."
                hx-on--after-request="if(event.detail.successful) { window.location.href='/admin/species'; }"
              ) Delete Species

    +footer()
