include header.pug

- const stringCell = ['p-3', 'text-left', 'border-b', 'border-gray-200'];
- const heading = ['p-3', 'text-left', 'font-bold', 'text-gray-900', 'border-b-2', 'border-gray-300', 'bg-gray-50', 'cursor-pointer', 'select-none', 'hover:bg-gray-100'];
- const numberCell = ['p-3', 'text-right', 'border-b', 'border-gray-200'];
- const numberHeading = ['p-3', 'text-right', 'font-bold', 'text-gray-900', 'border-b-2', 'border-gray-300', 'bg-gray-50', 'cursor-pointer', 'select-none', 'hover:bg-gray-100'];

mixin submissionTable(submissions, totalPoints)
	.overflow-x-auto.w-full
		table(data-sortable class="w-full bg-white shadow-sm rounded-lg")
			thead
				tr
					th(class=heading) Class
					th(class=heading) Common Name
					th(class=heading) Latin Name
					th(class=heading data-sort-method="date" data-sort-default) Submitted On
					th(class=numberHeading data-sort-method="number") Species Points
					th(class=numberHeading data-sort-method="number") Total Points

			tbody
				each sub in submissions
					tr(class="hover:bg-gray-50")
						td(class=stringCell)= sub.species_class
						td(class=stringCell)
							a.link(href=`/sub/${sub.id}`)= sub.species_common_name
						td(class=stringCell)
							a.link(href=`/sub/${sub.id}`)= sub.species_latin_name
						- const dateString = sub.submitted_on && new Date(sub.submitted_on).toLocaleDateString();
						td(class=stringCell)= dateString
						td(class=numberCell)= sub.points || "Unapproved"
						td(class=numberCell)= sub.total_points || "Unapproved"

			if totalPoints > 0
				tfoot
					tr(class="border-t-2 border-gray-800 font-bold bg-gray-50")
						td(class=stringCell) Total:
						td(class=stringCell)
						td(class=stringCell)
						td(class=stringCell)
						td(class=numberCell)
						td(class=numberCell)= totalPoints

doctype html
html
	+headTag(member.display_name)
		script(src='/tablesort.min.js')
		script(src='/tablesort.number.min.js')
		script(src='/tablesort.date.min.js')
		script.
			document.addEventListener('DOMContentLoaded', function() {
				const tables = document.querySelectorAll('table[data-sortable]');
				tables.forEach(table => {
					new Tablesort(table, {
						descending: true // Default to descending for date (most recent first)
					});
				});
			});

	body.bg-white.text-gray-800
		+pageHeader(isLoggedIn, member.display_name)
		if fishSubs.length > 0
			section.bg-gray-100
				div.w-full.text-center.px-4
					h3(class="text-xl lg:text-4xl font-extrabold mb-4") Breeders Awards Submissions
					+submissionTable(fishSubs, fishTotalPoints)

		if plantSubs.length > 0
			section.bg-gray-100
				div.w-full.text-center.px-4
					h3(class="text-xl lg:text-4xl font-extrabold mb-4") Horticultural Awards Submissions
					+submissionTable(plantSubs, plantTotalPoints)

		if coralSubs.length > 0
			section.bg-gray-100
				div.w-full.text-center.px-4
					h3(class="text-xl lg:text-4xl font-extrabold mb-4") Coral Awards Submissions
					+submissionTable(coralSubs, coralTotalPoints)
